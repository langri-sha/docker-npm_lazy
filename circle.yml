machine:
  services:
    - docker
  environment:
    IMAGE: npm-lazy
    PACKAGE: process
    test: npm-lazy-test
    test_environment: npm-lazy-test-environment

dependencies:
  override:
    - docker build -t $IMAGE --rm=false .
    - docker pull node:0.12

test:
  pre:
    - docker run -d --name $test $IMAGE --port=80 --external-url=http://${test}
    - docker run -d --name $test_environment -e NPM_LAZY_PORT=80 -e NPM_LAZY_EXTERNAL_URL=http://${test_environment} $IMAGE
  override:
    - docker run --link $test -e npm_config_registry=http://${test} node:0.12 npm install --verbose $PACKAGE
    - docker run --link $test_environment -e npm_config_registry=http://${test_environment} node:0.12 npm install --verbose $PACKAGE
